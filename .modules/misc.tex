\makeatletter

% Page layout
\@ifclassloaded{article}{
    \usepackage[b5paper]{geometry}
}

% Line spacing
\usepackage{setspace}
\onehalfspacing

% Make all sections unnumbered
\setcounter{secnumdepth}{0}

% Tables
\usepackage{tabularray}
\UseTblrLibrary{booktabs}

% Smart quotation marks
\usepackage[maxlevel=4]{csquotes}

% Micro-typographic refinements
\usepackage{microtype}

% Fix spacing issues for ellipses
\usepackage[xspace]{ellipsis}
% See the Companion, 3rd ed., vol. 1, p. 148.

% Silence warnings
\usepackage{silence}
\WarningFilter{microtype}{Unable to apply patch `footnote'}
% If packages `silence` and `hyperref` are loaded together, then do not include
% blackboard bold math characters in section titles. Otherwise, the compiler
% will enter an infinite loop. See <https://tex.stackexchange.com/q/431162>.

% The manual recommends that `hyperref` be loaded after all other packages.
\usepackage[]{hyperref}
\hypersetup{
    allcolors = black,
    breaklinks = true,
    colorlinks = true,
    hypertexnames = false, % or `perpage` will lead to duplicate PDF anchors
}

% Set links in roman
\urlstyle{rm}

% Commas between consecutive footnotes
\let\oldFootnote\footnote
\newcommand\nextToken\relax
\renewcommand\footnote[1]{\oldFootnote{#1}\futurelet\nextToken\isFootnote}
\newcommand\isFootnote{\ifx\footnote\nextToken\textsuperscript{,}\fi}
% From <https://tex.stackexchange.com/a/62091>. Put after `hyperref`.

\makeatother
